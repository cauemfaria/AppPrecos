# Running the Django PWA Server Locally

## Prerequisites
1. Python 3.12+ installed
2. uv package manager installed (run: `py -m pip install uv`)
3. Supabase credentials in `.env` file (already created)

## Quick Start

### 1. Navigate to the webapp directory:
```powershell
cd C:\AppPrecos\webapp
```

### 2. Install Playwright browsers (one-time setup):
```powershell
py -m uv run playwright install chromium
```

### 3. Run database migrations (one-time setup):
```powershell
py -m uv run python manage.py migrate
```

### 4. Start the development server:
```powershell
py -m uv run python manage.py runserver
```

The server will start at: http://127.0.0.1:8000/

## Accessing the App

- **Dashboard**: http://127.0.0.1:8000/
- **QR Scanner**: http://127.0.0.1:8000/nfce/scan/
- **API Root**: http://127.0.0.1:8000/api/
- **Admin**: http://127.0.0.1:8000/admin/ (requires superuser)

## PWA Features

When accessing from Chrome/Edge on your phone:
1. Navigate to http://[YOUR_LOCAL_IP]:8000/
2. Look for "Install App" banner
3. The app works offline after first visit

## Stopping the Server

Press `Ctrl+C` in the terminal window

## Environment Variables

The `.env` file in `webapp/` directory already contains:
- SUPABASE_URL
- SUPABASE_SERVICE_ROLE_KEY
- SUPABASE_ANON_KEY
- DATABASE_URL
- DJANGO_SECRET_KEY
- DJANGO_DEBUG=true
- DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1,0.0.0.0
- DJANGO_CSRF_TRUSTED=http://localhost:8000,http://127.0.0.1:8000

## Testing with QR Scanner

1. Visit http://127.0.0.1:8000/nfce/scan/
2. Allow camera access when prompted
3. Point camera at NFCe QR code
4. Click "Enviar NFC-e" when URL is captured
5. Data will be sent to Supabase

## Running Tests

```powershell
cd C:\AppPrecos\webapp
py -m uv run python manage.py test
```

## Collecting Static Files (for production simulation)

```powershell
py -m uv run python manage.py collectstatic --noinput
```

## Common Issues

### Server won't start
- Check that port 8000 is not already in use
- Verify `.env` file exists in `webapp/` directory
- Ensure uv dependencies are synced: `py -m uv sync`

### Supabase errors
- Verify credentials in `.env` are correct
- Test connection: `py -m uv run python -c "import django; django.setup(); from core.services import supabase_service; print(supabase_service.validate_database_schema())"`

### Template errors
- Run: `py -m uv run python manage.py check`
- Check for missing `{% load static %}` tags in templates

### Camera not working
- Use HTTPS or localhost (browsers require secure context)
- Check browser permissions for camera access
- Try different browser (Chrome/Edge recommended)

## Full Command Sequence (First Time)

```powershell
# Navigate to project
cd C:\AppPrecos\webapp

# Install dependencies (if needed)
py -m uv sync

# Install Playwright browsers
py -m uv run playwright install chromium

# Run migrations
py -m uv run python manage.py migrate

# Collect static files (optional)
py -m uv run python manage.py collectstatic --noinput

# Start server
py -m uv run python manage.py runserver
```

## Subsequent Runs

```powershell
cd C:\AppPrecos\webapp
py -m uv run python manage.py runserver
```

That's it! The server will auto-reload when you edit files.






